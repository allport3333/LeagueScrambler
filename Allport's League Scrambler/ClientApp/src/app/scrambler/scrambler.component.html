<div class="container-fluid" [hidden]="hideEverything">
    <div class="row">
        <div class="col-12">
            <mat-card style="background-color:lightgray; " class="ml-1 mt-2">
                <div class="row">
                    <!--<div class="col">
                        <mat-card style="background-color:lightgray;" class="d-flex flex-column align-items-center">
                            <h4>Select League</h4>
                            <div class="mt-1">
                                <mat-form-field>
                                    <mat-label>League</mat-label>
                                    <mat-select style="min-width:180px;" [(ngModel)]="selectedLeague" (selectionChange)="selectLeague()">
                                        <mat-option *ngFor="let league of leaguesAvailable" [value]="league.leagueName">
                                            {{league.leagueName}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </mat-card>
                    </div>-->
                    <div class="col text-center">
                        <mat-card style="background-color:lightgray;" class="d-flex flex-column align-items-center">
                            <h4>Max Team Size</h4>
                            <div class="mt-1">
                                <mat-form-field>
                                    <mat-label>Max Team Size</mat-label>
                                    <mat-select [(ngModel)]="teamSize" (ngModelChange)="updateNumberOfTeams($event); teamSizeSelected = true; numberOfTeamsSelected = false; ">
                                        <mat-option *ngFor="let team of teamSizePossible" [value]="team">
                                            {{team}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <p [style.color]="teamSizeSelected ? '#999' : 'red'" style="font-size: 12px; margin-top: 5px;">Deselected when number of teams selected.</p>
                            </div>
                        </mat-card>
                    </div>
                    <div class="col text-center">
                        <mat-card style="background-color: lightgray;" class="d-flex flex-column align-items-center">
                            <h4>Number of Teams</h4>
                            <div class="mt-1">
                                <mat-form-field>
                                    <mat-label style="font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Number of Teams</mat-label>
                                    <mat-select [(ngModel)]="numberOfTeams" (ngModelChange)="updateTeamSize($event); numberOfTeamsSelected = true; teamSizeSelected = false;">
                                        <mat-option *ngFor="let maxNumberTeam of maxNumberOfTeams" [value]="maxNumberTeam">
                                            {{maxNumberTeam}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <p [style.color]="numberOfTeamsSelected ? '#999' : 'red'" style="font-size: 12px; margin-top: 5px;">Deselected when max team size selected.</p>
                            </div>
                            <!-- Teams Needed Section -->
                            <div class="text-center mt-3" style="font-size: 14px;">
                                <button mat-raised-button color="primary" (click)="toggleTeamFormationVisibility()">
                                    Teams That Can Be Formed
                                </button>

                                <!-- Toggleable content -->
                                <div *ngIf="showTeamFormation" class="d-flex justify-content-center align-items-center mt-3" style="gap: 20px;">
                                    <!-- 2 Player Teams -->
                                    <div style="background-color: #eeeeee; border: 1px solid gray; border-radius: 5px; padding: 10px 15px; text-align: center;">
                                        <p style="margin: 0; font-weight: bold; font-size: 14px; color: gray;">2 Player Teams</p>
                                        <p [ngStyle]="{'color': remainderTwo === 0 ? 'green' : 'red'}" style="margin: 0; font-size: 16px; font-weight: bold;">
                                            {{ teamsNeededTwo }}
                                        </p>
                                        <p *ngIf="remainderTwo !== 0" style="color: red; font-size: 12px;">
                                            Add {{ 2 - remainderTwo }} more player(s) for even teams.
                                        </p>
                                    </div>

                                    <!-- 3 Player Teams -->
                                    <div style="background-color: #eeeeee; border: 1px solid gray; border-radius: 5px; padding: 10px 15px; text-align: center;">
                                        <p style="margin: 0; font-weight: bold; font-size: 14px; color: gray;">3 Player Teams</p>
                                        <p [ngStyle]="{'color': remainderThree === 0 ? 'green' : 'red'}" style="margin: 0; font-size: 16px; font-weight: bold;">
                                            {{ teamsNeededThree }}
                                        </p>
                                        <p *ngIf="remainderThree !== 0" style="color: red; font-size: 12px;">
                                            Add {{ 3 - remainderThree }} more player(s) for even teams.
                                        </p>
                                    </div>

                                    <!-- 4 Player Teams -->
                                    <div style="background-color: #eeeeee; border: 1px solid gray; border-radius: 5px; padding: 10px 15px; text-align: center;">
                                        <p style="margin: 0; font-weight: bold; font-size: 14px; color: gray;">4 Player Teams</p>
                                        <p [ngStyle]="{'color': remainderFour === 0 ? 'green' : 'red'}" style="margin: 0; font-size: 16px; font-weight: bold;">
                                            {{ teamsNeededFour }}
                                        </p>
                                        <p *ngIf="remainderFour !== 0" style="color: red; font-size: 12px;">
                                            Add {{ 4 - remainderFour }} more player(s) for even teams.
                                        </p>
                                    </div>
                                </div>
                            </div>

                        </mat-card>

                    </div>
                </div>

                <div class="row justify-content-center mt-3">
                    <div class="col-12 col-md-6 text-center">
                        <mat-checkbox [(ngModel)]="completeRandom" aria-label="check box 1" style="margin-right: 10px"> Completely Random</mat-checkbox>
                        <mat-checkbox [(ngModel)]="lockedResults" aria-label="check box 2" style="margin-right: 10px"> Lock Results</mat-checkbox>
                    </div>
                </div>

            </mat-card>

            <div class="row justify-content-center mt-3">
                <div *ngIf="!hideInputOptions" class="col-lg-2 col-md-4 col-sm-6 col-12 mb-3">
                    <button (click)="scramblePlayers(false)"
                            mat-raised-button
                            color="primary"
                            class="w-100"
                            matTooltip="Button is disabled because no players are selected."
                            [matTooltipDisabled]="selectedList && selectedList.length > 0"
                            [disabled]="!selectedList || selectedList.length === 0">
                        Scramble Players
                    </button>
                </div>
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <button mat-raised-button color="primary" [matMenuTriggerFor]="resetMenu" class="w-100">
                        Reset Players
                    </button>

                    <mat-menu #resetMenu="matMenu">
                        <button mat-menu-item (click)="reset()">
                            <span>Reset All Players</span>
                        </button>
                        <button mat-menu-item (click)="resetTopPlayers()">
                            <span>Reset Top Players</span>
                        </button>
                        <button mat-menu-item (click)="resetLowPlayers()">
                            <span>Reset Low Players</span>
                        </button>
                        <button mat-menu-item (click)="resetByePlayers()">
                            <span>Reset Bye Players</span>
                        </button>
                    </mat-menu>
                </div>

                <div class="col-lg-2 col-md-4 col-sm-6 col-12 mb-3">
                    <button (click)="hidePlayerList()" mat-raised-button color="primary" class="w-100">
                        {{ hidePlayers ? 'Show Player List' : 'Hide Player List' }}
                    </button>
                </div>
            </div>

            <div class="text-center mt-3" *ngIf="hideInputOptions">
                <button *ngIf="!lockedResults" style="margin-top:10px; margin-left: 10px" (click)="scramblePlayers(false)" mat-raised-button color="primary">Scramble Players</button>
                <div class="mt-2">
                    <mat-checkbox [(ngModel)]="completeRandom"> Completely Random?</mat-checkbox>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <mat-card class=" ml-3 mt-2 " style="background-color:lightgray; ">

                <mat-tab-group mat-align-tabs="center" #tabGroup (selectedTabChange)="onTabChange($event)">
                    <mat-tab label="Select Players" *ngIf="selectedLeague">
                        <div class="container-fluid">
                            <div class="row">

                                <div class="col-12" id="hideInputOptions">
                                    <div [hidden]="playerLoading">
                                        <mat-card id="playerListHidden" style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                                            <mat-card-title style="color: gray; margin: -10px -10px -5px -10px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
                                                <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap;">
                                                    <button mat-raised-button color="primary" (click)="selectAllPlayers()" style="font-size: 14px; padding: 5px; min-width: 80px;">
                                                        Select All
                                                    </button>
                                                    <span style="margin-left: 10px;"></span>
                                                    <button mat-raised-button color="warn" (click)="deselectAllPlayers()" style="font-size: 14px; padding: 5px; min-width: 80px;">
                                                        Deselect All
                                                    </button>
                                                    <span style="margin-left: 10px;"></span>
                                                    <!-- Fetch Button -->
                                                    <button mat-raised-button color="primary" (click)="fetchSelectedList()" style="font-size: 14px; padding: 5px; min-width: 80px;">
                                                        Fetch Signed In Players
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap;">
                                                    <!-- Player Selected Details -->
                                                    <div *ngIf="!isSmallScreen" style="margin-right: 10px; margin-top:10px; font-size: 20px;">
                                                        Total Players Selected - {{ selectedList.length }}
                                                    </div>
                                                    <div *ngIf="isSmallScreen" style="margin-right: 10px; margin-top: 10px; font-size: 12px;">
                                                        Total Players Selected - {{ selectedList.length }}
                                                    </div>

                                                    <!-- Male and Female Details on Next Line -->
                                                    <div style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; width: 100%; margin-top: 10px;">
                                                        <div *ngIf="!isSmallScreen" style="margin-right: 10px; font-size: 20px;">
                                                            Male: {{ getTotalMaleSelectedPlayers() }}
                                                        </div>
                                                        <div *ngIf="!isSmallScreen" style="margin-right: 10px; font-size: 20px;">
                                                            Female: {{ getTotalFemaleSelectedPlayers() }}
                                                        </div>
                                                        <div *ngIf="isSmallScreen" style="margin-right: 10px; font-size: 12px;">
                                                            Male: {{ getTotalMaleSelectedPlayers() }}
                                                        </div>
                                                        <div *ngIf="isSmallScreen" style="margin-right: 10px; font-size: 12px;">
                                                            Female: {{ getTotalFemaleSelectedPlayers() }}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="text-center mt-2" style="font-size: 14px;">
                                                    <button mat-raised-button color="primary" (click)="togglePlayersVisibility()">
                                                        Required Players For Top/Low Players
                                                    </button>

                                                    <!-- Toggleable content -->
                                                    <div *ngIf="showPlayerTeams" class="d-flex justify-content-center align-items-center mt-3" style="gap: 20px;">
                                                        <!-- 2 Player Teams -->
                                                        <div [style.background-color]="numberOfPlayersNeededTwo <= selectedList.length ? '#d4edda' : '#f8d7da'"
                                                             [style.color]="numberOfPlayersNeededTwo <= selectedList.length ? '#155724' : '#721c24'"
                                                             style="border: 1px solid #ccc; padding: 10px 20px; border-radius: 5px; text-align: center;">
                                                            <p style="margin: 0;">
                                                                <strong>2 Player Teams:</strong><br />
                                                                <span>{{ numberOfPlayersNeededTwo || '-' }}</span>
                                                            </p>
                                                        </div>

                                                        <!-- 3 Player Teams -->
                                                        <div [style.background-color]="numberOfPlayersNeededThree <= selectedList.length ? '#d4edda' : '#f8d7da'"
                                                             [style.color]="numberOfPlayersNeededThree <= selectedList.length ? '#155724' : '#721c24'"
                                                             style="border: 1px solid #ccc; padding: 10px 20px; border-radius: 5px; text-align: center;">
                                                            <p style="margin: 0;">
                                                                <strong>3 Player Teams:</strong><br />
                                                                <span>{{ numberOfPlayersNeededThree || '-' }}</span>
                                                            </p>
                                                        </div>

                                                        <!-- 4 Player Teams -->
                                                        <div [style.background-color]="numberOfPlayersNeededFour <= selectedList.length ? '#d4edda' : '#f8d7da'"
                                                             [style.color]="numberOfPlayersNeededFour <= selectedList.length ? '#155724' : '#721c24'"
                                                             style="border: 1px solid #ccc; padding: 10px 20px; border-radius: 5px; text-align: center;">
                                                            <p style="margin: 0;">
                                                                <strong>4 Player Teams:</strong><br />
                                                                <span>{{ numberOfPlayersNeededFour || '-' }}</span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>

                                            </mat-card-title>

                                            <mat-selection-list dense [(ngModel)]="selectedList" (ngModelChange)="addPlayer($event)">
                                                <div>
                                                    <!-- Male Players -->
                                                    <div style="display: flex; flex-direction: column;">
                                                        <!-- Male Players -->
                                                        <div style="display: flex; flex-direction: column;">
                                                            <mat-list style="display: flex; flex-wrap: wrap; justify-content: space-between;">
                                                                <mat-list-option [style.width.%]="isSmallScreen ? 48 : 23"
                                                                                 [style.margin-bottom.px]="5"
                                                                                 style="background-color: #DBFDFF; padding: 3px 5px; border-radius: 5px;"
                                                                                 *ngFor="let player1 of malePlayers1; let i = index"
                                                                                 [value]="player1"
                                                                                 [disableRipple]="true"
                                                                                 checkboxPosition="before">

                                                                    <div style="display: flex; align-items: center; gap: 3px;" *ngIf="!isSmallScreen">
                                                                        <!-- Top Player Button -->
                                                                        <button *ngIf="!player1.isTopPlayer" mat-icon-button style="margin-left: -12px;" (click)="addPlayerToTopPlayerList(player1); $event.stopPropagation()" matTooltip="Set Top Player">
                                                                            <mat-icon>star_border</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isTopPlayer" mat-icon-button style="margin-left: -12px;" (click)="removePlayerFromTopPlayerList(player1); $event.stopPropagation()" matTooltip="Remove Top Player">
                                                                            <mat-icon>star</mat-icon>
                                                                        </button>


                                                                        <!-- Low Player Button -->
                                                                        <button *ngIf="!player1.isLowPlayer" mat-icon-button style="margin-left: -12px;" (click)="addPlayerToLowPlayerList(player1); $event.stopPropagation()" matTooltip="Set Low Player">
                                                                            <mat-icon>signal_cellular_null</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isLowPlayer" mat-icon-button style="margin-left: -12px;" (click)="removePlayerFromLowPlayerList(player1); $event.stopPropagation()" matTooltip="Remove Low Player">
                                                                            <mat-icon>signal_cellular_4_bar</mat-icon>
                                                                        </button>

                                                                        <!-- Bye Player Button -->
                                                                        <button *ngIf="!player1.isByePlayer" mat-icon-button style="margin-left: -12px;" (click)="addPlayerToByeList(player1); $event.stopPropagation()" matTooltip="Set Bye Player">
                                                                            <mat-icon>radio_button_unchecked</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isByePlayer" mat-icon-button style="margin-left: -12px;" (click)="removePlayerFromByeList(player1); $event.stopPropagation()" matTooltip="Remove Bye Player">
                                                                            <mat-icon>cancel</mat-icon>
                                                                        </button>

                                                                        <!-- Female Player For a Day Button -->
                                                                        <button mat-icon-button style="margin-left: -12px;"
                                                                                (click)="swapGender(player1); $event.stopPropagation()"
                                                                                [matTooltip]="player1.isMale ? 'Set Female Player' : 'Set Male Player'">
                                                                            <mat-icon>{{ player1.isMale ? 'male' : 'female' }}</mat-icon>
                                                                        </button>

                                                                        <!-- Player Name -->
                                                                        <span style="font-size: .9rem;">{{ player1.firstName }} {{ player1.lastName }}</span>

                                                                    </div>
                                                                    <div style="display: flex; align-items: center; gap: 8px;" *ngIf="isSmallScreen">
                                                                        <!-- Player Name -->
                                                                        <span style="flex-grow: 1; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                                            {{ player1.firstName }} {{ player1.lastName }}
                                                                        </span>
                                                                        <!-- Small Arrow Dropdown -->
                                                                        <mat-select [(value)]="player1.action"
                                                                                    (selectionChange)="handleDropdownChange(player1, $event)"
                                                                                    (click)="$event.stopPropagation()"
                                                                                    style="flex-shrink: 0; width: 32px; height: 32px; padding: 0;">
                                                                            <mat-option *ngIf="!player1.isTopPlayer" [value]="'setTopPlayer'">Set Top Player</mat-option>
                                                                            <mat-option *ngIf="player1.isTopPlayer" [value]="'removeTopPlayer'">Remove Top Player</mat-option>
                                                                            <mat-option *ngIf="!player1.isLowPlayer" [value]="'setLowPlayer'">Set Low Player</mat-option>
                                                                            <mat-option *ngIf="player1.isLowPlayer" [value]="'removeLowPlayer'">Remove Low Player</mat-option>
                                                                            <mat-option *ngIf="!player1.isByePlayer" [value]="'setByePlayer'">Set Bye Player</mat-option>
                                                                            <mat-option *ngIf="player1.isByePlayer" [value]="'removeByePlayer'">Remove Bye Player</mat-option>
                                                                            <mat-option [value]="'swapGender'">{{ player1.isMale ? 'Set Female Player' : 'Set Male Player' }}</mat-option>
                                                                        </mat-select>
                                                                    </div>


                                                                </mat-list-option>
                                                            </mat-list>
                                                        </div>


                                                    </div>

                                                    <!-- Divider -->
                                                    <mat-divider></mat-divider>

                                                    <!-- Female Players -->
                                                    <div style="display: flex; flex-direction: column;">
                                                        <div style="display: flex; flex-direction: column;">
                                                            <mat-list style="display: flex; flex-wrap: wrap; justify-content: space-between;">
                                                                <mat-list-option [style.width.%]="isSmallScreen ? 48 : 23"
                                                                                 [style.margin-bottom.px]="5"
                                                                                 style="background-color: #FCE0FF; padding: 3px 5px; border-radius: 5px;"
                                                                                 *ngFor="let player1 of femalePlayers1; let i = index"
                                                                                 [value]="player1"
                                                                                 [disableRipple]="true"
                                                                                 checkboxPosition="before">

                                                                    <div style="display: flex; align-items: center; gap: 3px;" *ngIf="!isSmallScreen">
                                                                        <!-- Top Player Button -->
                                                                        <button *ngIf="!player1.isTopPlayer" mat-icon-button style="margin-left: -12px;" (click)="addPlayerToTopPlayerList(player1); $event.stopPropagation()" matTooltip="Set Top Player">
                                                                            <mat-icon>star_border</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isTopPlayer" mat-icon-button style="margin-left: -12px; " (click)="removePlayerFromTopPlayerList(player1); $event.stopPropagation()" matTooltip="Remove Top Player">
                                                                            <mat-icon>star</mat-icon>
                                                                        </button>

                                                                        <!-- Low Player Button -->
                                                                        <button *ngIf="!player1.isLowPlayer" mat-icon-button style="margin-left: -12px; " (click)="addPlayerToLowPlayerList(player1); $event.stopPropagation()" matTooltip="Set Low Player">
                                                                            <mat-icon>signal_cellular_null</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isLowPlayer" mat-icon-button style="margin-left: -12px; " (click)="removePlayerFromLowPlayerList(player1); $event.stopPropagation()" matTooltip="Remove Low Player">
                                                                            <mat-icon>signal_cellular_4_bar</mat-icon>
                                                                        </button>

                                                                        <!-- Bye Player Button -->
                                                                        <button *ngIf="!player1.isByePlayer" mat-icon-button style="margin-left: -12px; " (click)="addPlayerToByeList(player1); $event.stopPropagation()" matTooltip="Set Bye Player">
                                                                            <mat-icon>radio_button_unchecked</mat-icon>
                                                                        </button>
                                                                        <button *ngIf="player1.isByePlayer" mat-icon-button style="margin-left: -12px; " (click)="removePlayerFromByeList(player1); $event.stopPropagation()" matTooltip="Remove Bye Player">
                                                                            <mat-icon>cancel</mat-icon>
                                                                        </button>


                                                                        <!-- Male Player For a Day Button -->
                                                                        <button mat-icon-button style="margin-left: -12px;"
                                                                                (click)="swapGender(player1); $event.stopPropagation()"
                                                                                [matTooltip]="player1.isMale ? 'Set Female Player' : 'Set Male Player'">
                                                                            <mat-icon>{{ player1.isMale ? 'male' : 'female' }}</mat-icon>
                                                                        </button>


                                                                        <!-- Player Name -->
                                                                        <span style="font-size: .9rem;">{{ player1.firstName }} {{ player1.lastName }}</span>

                                                                    </div>
                                                                    <div style="display: flex; align-items: center; gap: 8px;" *ngIf="isSmallScreen">
                                                                        <!-- Player Name -->
                                                                        <span style="flex-grow: 1; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                                            {{ player1.firstName }} {{ player1.lastName }}
                                                                        </span>
                                                                        <!-- Small Arrow Dropdown -->
                                                                        <mat-select [(value)]="player1.action"
                                                                                    (selectionChange)="handleDropdownChange(player1, $event)"
                                                                                    (click)="$event.stopPropagation()"
                                                                                    style="flex-shrink: 0; width: 32px; height: 32px; padding: 0;">
                                                                            <mat-option *ngIf="!player1.isTopPlayer" [value]="'setTopPlayer'">Set Top Player</mat-option>
                                                                            <mat-option *ngIf="player1.isTopPlayer" [value]="'removeTopPlayer'">Remove Top Player</mat-option>
                                                                            <mat-option *ngIf="!player1.isLowPlayer" [value]="'setLowPlayer'">Set Low Player</mat-option>
                                                                            <mat-option *ngIf="player1.isLowPlayer" [value]="'removeLowPlayer'">Remove Low Player</mat-option>
                                                                            <mat-option *ngIf="!player1.isByePlayer" [value]="'setByePlayer'">Set Bye Player</mat-option>
                                                                            <mat-option *ngIf="player1.isByePlayer" [value]="'removeByePlayer'">Remove Bye Player</mat-option>
                                                                            <mat-option [value]="'swapGender'">{{ player1.isMale ? 'Set Female Player' : 'Set Male Player' }}</mat-option>
                                                                        </mat-select>
                                                                    </div>

                                                                </mat-list-option>
                                                            </mat-list>
                                                        </div>
                                                    </div>

                                                </div>

                                            </mat-selection-list>
                                        </mat-card>

                                    </div>
                                    <div [hidden]="!playerLoading" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center;">
                                        <div style="text-align: center;">
                                            <h2 class="ml-4">Loading...</h2>
                                            <div style="display: inline-block;">
                                                <mat-spinner diameter="200"></mat-spinner>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </mat-tab>
                    <mat-tab label="Retrieve Scramble" *ngIf="selectedLeague">
                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                            <div class="tab-content d-flex flex-column align-items-center">
                                <h5 class="mb-2">Retrieve Previous Scramble</h5>
                                <mat-selection-list dense [(ngModel)]="selectedRetrieveScrambleList" (ngModelChange)="updateScrambleNumbers($event)">
                                    <div>
                                        <!-- Male Players -->
                                        <div style="display: flex; flex-direction: column;">
                                            <mat-list style="display: flex; flex-wrap: wrap; justify-content: space-between;">
                                                <mat-list-option [style.width.%]="getListItemWidth(queriedScrambles.length)" [style.margin-bottom.px]="isSmallScreen ? 10 : 2" style="background-color: lightgray; text-align: center;" *ngFor="let scramble of queriedScrambles; let i = index" [value]="scramble">
                                                    <div style="display: flex; align-items: center; justify-content: center;">
                                                        <div style="margin: 5px;">
                                                            <!-- Add margin here -->
                                                            <span>Scramble Number: <b>{{ scramble.scrambleNumber }}</b></span>
                                                            <br>
                                                            <span>Date of Scramble: {{ scramble.dateOfTeam | date:'shortDate' }}</span>
                                                        </div>
                                                        <button mat-icon-button (click)="retrieveScramble(scramble); $event.stopPropagation()" matTooltip="Retrieve Scramble">
                                                            <mat-icon>sync</mat-icon>
                                                        </button>
                                                    </div>
                                                </mat-list-option>
                                            </mat-list>
                                        </div>
                                    </div>
                                </mat-selection-list>
                                <ng-container *ngIf="!isSmallScreen"><br></ng-container>
                                <button mat-raised-button color="primary" (click)="retrieveMultipleScrambles()">Retrieve All Selected Scrambles</button>
                                <br *ngIf="listOfRetrievedScrambleNumbers.length > 0" />
                                <!-- Display selected scramble numbers at the bottom -->
                                <div *ngIf="listOfRetrievedScrambleNumbers.length > 0" style="text-align: center;">
                                    <span>Retrieved Scramble Numbers To Use:</span>
                                    <br>

                                    <div style="margin: 0 auto; display: inline-block;">
                                        <ng-container *ngFor="let scrambleNumber of listOfRetrievedScrambleNumbers; let last = last; let i = index">
                                            <span>Scramble Number: </span> <b>{{ scrambleNumber }}</b>
                                            <span *ngIf="!last">, </span>
                                            <span *ngIf="i % 3 === 2 && !last"><br></span>
                                        </ng-container>
                                    </div>
                                </div>

                                <br />
                                <button mat-raised-button
                                        color="primary"
                                        [disabled]="!allowScrambleWithNoDuplicates && (!selectedList || selectedList.length === 0)"
                                        [ngStyle]="{'opacity': allowScrambleWithNoDuplicates ? '1' : '0.5'}"
                                        matTooltip="{{ getTooltipText() }}"
                                        [matTooltipDisabled]="allowScrambleWithNoDuplicates"
                                        (click)="scramblePlayers(true)">
                                    Scramble With No Duplicate Teams
                                </button>

                            </div>
                        </mat-card>
                    </mat-tab>
                    <!-- New Dropdown Retrieve Scramble Tab -->
                    <mat-tab label="Manage Scores" *ngIf="selectedLeague">
                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                            <div class="tab-content d-flex flex-column align-items-center">
                                <h5 class="mb-2">Select Scramble to Retrieve</h5>
                                <mat-form-field appearance="outline" style="width: 250px;">
                                    <mat-label>Select Scramble</mat-label>
                                    <mat-select (selectionChange)="retrieveScramble($event.value)">
                                        <mat-option *ngFor="let scramble of queriedScrambles" [value]="scramble">
                                            Scramble {{ scramble.scrambleNumber }} - {{ scramble.dateOfTeam | date: 'shortDate' }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field appearance="fill" style="display: inline-block; width: auto;" *ngIf="scrambleSelected">
                                    <mat-label>Number of Rounds</mat-label>
                                    <mat-select [(value)]="selectedRounds" (selectionChange)="onRoundsChange($event.value)">
                                        <mat-option *ngFor="let round of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]" [value]="round">
                                            {{ round }} Rounds
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="tab-content d-flex flex-column align-items-center" *ngIf="scrambleSelected">
                                <!-- Title -->
                                <h5 class="mb-2">Update Team Scores</h5>


                                <!-- Teams Table: Two-Column Layout -->
                                <div class="container">
                                    <div class="row">
                                        <!-- Left Column: Odd Teams -->
                                        <div class="col-6">
                                            <ng-container *ngFor="let team of listOfTeams; let i = index">
                                                <div *ngIf="(i + 1) % 2 !== 0" style="margin-bottom: 20px;">
                                                    <!-- Team Header -->
                                                    <h6 style="text-align: center;">Team {{ i + 1 }}</h6>
                                                    <!-- Team Scores Table -->
                                                    <table class="table table-sm table-bordered text-center" style="font-size: 12px;">
                                                        <thead>
                                                            <tr>
                                                                <th>Players</th>
                                                                <ng-container *ngFor="let round of rounds">
                                                                    <th>
                                                                        Round {{ round }}<br />
                                                                        <input type="checkbox"
                                                                               matTooltip="Round Won"
                                                                               [checked]="getScore(team.kingQueenTeamId, round)?.roundWon || false"
                                                                               (change)="updateRoundWon(team.kingQueenTeamId, round, $event.target.checked)"
                                                                               style="margin-top: 5px;" />
                                                                    </th>
                                                                </ng-container>
                                                                <!-- Total Score Column -->
                                                                <th>Total Score</th>
                                                                <!-- Total Wins Column -->
                                                                <th>Total Wins</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- Team Players -->
                                                            <tr>
                                                                <td>
                                                                    <div *ngFor="let player of team.players">
                                                                        {{ player.firstName }} {{ player.lastName }}
                                                                        <span *ngIf="player.isSub">(Sub)</span>
                                                                        <mat-slide-toggle matTooltip="Mark as Sub Score"
                                                                                          [checked]="player.isSubScore"
                                                                                          (change)="updateIsSubScore(team.kingQueenTeamId, player.id, $event.checked)">
                                                                        </mat-slide-toggle>
                                                                    </div>
                                                                </td>

                                                                <!-- Round Scores -->
                                                                <ng-container *ngFor="let round of rounds">
                                                                    <td style="text-align: center; vertical-align: middle;">
                                                                        <input type="number"
                                                                               [value]="getScore(team.kingQueenTeamId, round) ? getScore(team.kingQueenTeamId, round).roundScore : ''"
                                                                               (input)="updateRoundScore(team.kingQueenTeamId, round, $event.target.value)"
                                                                               class="form-control form-control-sm"
                                                                               style="text-align: center; width: 60px; margin: 0 auto;" />
                                                                    </td>
                                                                </ng-container>

                                                                <!-- Total Score Column -->
                                                                <td style="text-align: center; vertical-align: middle; font-weight: bold;">
                                                                    {{ calculateTotalScore(team.kingQueenTeamId) }}
                                                                </td>
                                                                <!-- Total Wins Column -->
                                                                <td style="text-align: center; vertical-align: middle; font-weight: bold;">
                                                                    {{ calculateTotalWins(team.kingQueenTeamId) }}
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                            </ng-container>
                                        </div>

                                        <!-- Right Column: Even Teams -->
                                        <div class="col-6">
                                            <ng-container *ngFor="let team of listOfTeams; let i = index">
                                                <div *ngIf="(i + 1) % 2 === 0" style="margin-bottom: 20px;">
                                                    <!-- Team Header -->
                                                    <h6 style="text-align: center;">Team {{ i + 1 }}</h6>
                                                    <!-- Team Scores Table -->
                                                    <table class="table table-sm table-bordered text-center" style="font-size: 12px;">
                                                        <thead>
                                                            <tr>
                                                                <th>Players</th>
                                                                <ng-container *ngFor="let round of rounds">
                                                                    <th>
                                                                        Round {{ round }}<br />
                                                                        <input type="checkbox"
                                                                               matTooltip="Round Won"
                                                                               [checked]="getScore(team.kingQueenTeamId, round)?.roundWon || false"
                                                                               (change)="updateRoundWon(team.kingQueenTeamId, round, $event.target.checked)"
                                                                               style="margin-top: 5px;" />
                                                                    </th>
                                                                </ng-container>
                                                                <!-- Total Score Column -->
                                                                <th>Total Score</th>
                                                                <!-- Total Wins Column -->
                                                                <th>Total Wins</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- Team Players -->
                                                            <tr>
                                                                <td>
                                                                    <div *ngFor="let player of team.players">
                                                                        {{ player.firstName }} {{ player.lastName }}
                                                                        <span *ngIf="player.isSub">(Sub)</span>
                                                                        <mat-slide-toggle matTooltip="Mark as Sub Score"
                                                                                          [checked]="player.isSubScore"
                                                                                          (change)="updateIsSubScore(team.kingQueenTeamId, player.id, $event.checked)">
                                                                        </mat-slide-toggle>
                                                                    </div>
                                                                </td>

                                                                <!-- Round Scores -->
                                                                <ng-container *ngFor="let round of rounds">
                                                                    <td style="text-align: center; vertical-align: middle;">
                                                                        <input type="number"
                                                                               [value]="getScore(team.kingQueenTeamId, round)?.roundScore || ''"
                                                                               (input)="updateRoundScore(team.kingQueenTeamId, round, $event.target.value)"
                                                                               class="form-control form-control-sm"
                                                                               style="text-align: center; width: 60px; margin: 0 auto;" />
                                                                    </td>
                                                                </ng-container>

                                                                <!-- Total Score Column -->
                                                                <td style="text-align: center; vertical-align: middle; font-weight: bold;">
                                                                    {{ calculateTotalScore(team.kingQueenTeamId) }}
                                                                </td>
                                                                <!-- Total Wins Column -->
                                                                <td style="text-align: center; vertical-align: middle; font-weight: bold;">
                                                                    {{ calculateTotalWins(team.kingQueenTeamId) }}
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex flex-column align-items-center" *ngIf="scrambleSelected">
                                <!-- Number of Rounds Selection -->

                                <button mat-raised-button color="primary" class="mb-3" *ngIf="showSaveRoundScores" (click)="saveKingQueenRoundScores()">Save Round Scores</button>
                            </div>

                        </mat-card>
                    </mat-tab>
                    <mat-tab label="Create Teams and Scores" *ngIf="selectedLeague">
                        <app-create-teams [selectedLeagueDto]="selectedLeagueDto"></app-create-teams>
                    </mat-tab>
                    <mat-tab label="Standings" *ngIf="selectedLeague">
                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                            <div class="tab-content d-flex flex-column align-items-center">
                                <h5 class="mb-2">Player Standings</h5>

                                <!-- Button -->
                                <button mat-raised-button color="primary" (click)="toggleStandingsType()" style="margin-bottom: 16px;">
                                    {{ standingsType === 'round' ? 'Show Standings by Matchup' : 'Show Standings by Round' }}
                                </button>

                                <!-- Dropdown Container -->
                                <div class="dropdown-container">
                                    <!-- Dropdown for Number of Subs Allowed -->
                                    <mat-form-field appearance="outline" style="width: 200px;">
                                        <mat-label>Number of Subs Allowed</mat-label>
                                        <mat-select [(value)]="numberOfSubsAllowed" (selectionChange)="onNumberOfSubsChange($event.value)">
                                            <mat-option [value]="0">No Subs Allowed</mat-option>
                                            <mat-option *ngFor="let i of [1, 2, 3, 4, 5, 100]" [value]="i">
                                                Allow {{ i }} {{ i === 1 ? 'Sub' : 'Subs' }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <!-- Percent of Score for Subs -->
                                    <mat-form-field appearance="outline" style="width: 200px;">
                                        <mat-label>Percent of Score for Subs</mat-label>
                                        <mat-select [(value)]="subScorePercent" (selectionChange)="onSubScorePercentChange($event.value)">
                                            <mat-option *ngFor="let percent of [100, 90, 80, 70, 60, 50]" [value]="percent">
                                                {{ percent }}%
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>

                                    <!-- Drop Lowest Scores -->
                                    <mat-form-field appearance="outline" id="drop-scores-select" style="width: 200px;">
                                        <mat-label>Drop Lowest Scores</mat-label>
                                        <mat-select [(value)]="dropLowest" (selectionChange)="onDropLowestChange($event.value)">
                                            <mat-option [value]="0">Don't Drop Any</mat-option>
                                            <mat-option *ngFor="let i of [1, 2, 3, 4, 5, 6]" [value]="i">
                                                Drop {{ i }} {{ i === 1 ? 'Score' : 'Scores' }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div style="margin-bottom: 10px; text-align: center;">
                                    <div style="font-weight: bold; margin-bottom: 5px;">Key:</div>
                                    <div>
                                        <span style="color: red; font-weight: bold;">Dropped Score</span> |
                                        <span style="color: red;">Reduced Score from Subs</span> |
                                        <span style="background-color: #D8BFD8;">Sub Score</span>
                                    </div>
                                </div>

                                <!-- Standings Card -->
                                <div class="card" style="margin: 20px; padding: 20px; max-width: 100%; overflow-x: auto;">
                                    <mat-tab-group [(selectedIndex)]="innerTabIndex">
                                        <!-- Male Standings Tab -->
                                        <mat-tab label="Men's Standings">
                                            <table class="table table-bordered table-striped compact-table"
                                                   style="width: 100%; table-layout: auto; font-size: 0.75rem;">
                                                <thead>
                                                    <tr>
                                                        <th style="min-width: 50px; padding: 4px; cursor: pointer;">
                                                            Place
                                                        </th>
                                                        <th style="min-width: 135px; padding: 4px; cursor: pointer;" (click)="sortStandings('playerName')">
                                                            Player Name
                                                            <mat-icon *ngIf="sortColumn === 'playerName'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalScore')">
                                                            King Queen Score
                                                            <mat-icon *ngIf="sortColumn === 'totalScore'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalScoreBeforeReduction')">
                                                            Total Points
                                                            <mat-icon *ngIf="sortColumn === 'totalScoreBeforeReduction'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalWins')">
                                                            Total Wins
                                                            <mat-icon *ngIf="sortColumn === 'totalWins'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th *ngFor="let round of standingsRounds.slice().reverse()" style="min-width: 70px; padding: 4px; text-align: center;">
                                                            <span>{{ standingsType === 'matchup' ? 'Matchup' : 'Round' }}</span><br>
                                                            <span>{{ round }}</span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let player of maleStandings; let i = index">
                                                        <td style="padding: 2px; min-width: 50px; text-align: center; font-weight: bold;">
                                                            {{ i + 1 }} <!-- Display place as 1-based index -->
                                                        </td>
                                                        <td style="padding: 2px; min-width: 135px;">{{ player.playerName }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalScore }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalScoreBeforeReduction }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalWins }}</td>
                                                        <td *ngFor="let score of player.scores.slice().reverse()"
                                                            [style.color]="score.isDropped || (score.isReduced && score.isSubScore) ? 'red' : 'inherit'"
                                                            [style.fontWeight]="score.isDropped ? 'bold' : 'normal'"
                                                            [style.backgroundColor]="score.isSubScore ? '#D8BFD8' : 'inherit'"
                                                            style="padding: 2px; min-width: 70px;">
                                                            {{ score.score }}
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </mat-tab>

                                        <!-- Female Standings Tab -->
                                        <mat-tab label="Women's Standings">
                                            <table class="table table-bordered table-striped compact-table"
                                                   style="width: 100%; table-layout: auto; font-size: 0.75rem;">
                                                <thead>
                                                    <tr>
                                                        <th style="min-width: 50px; padding: 4px; cursor: pointer;">
                                                            Place
                                                        </th>
                                                        <th style="min-width: 135px; padding: 4px; cursor: pointer;" (click)="sortStandings('playerName')">
                                                            Player Name
                                                            <mat-icon *ngIf="sortColumn === 'playerName'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalScore')">
                                                            King Queen Score
                                                            <mat-icon *ngIf="sortColumn === 'totalScore'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalScoreBeforeReduction')">
                                                            Total Points
                                                            <mat-icon *ngIf="sortColumn === 'totalScoreBeforeReduction'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th style="min-width: 80px; padding: 4px; cursor: pointer;" (click)="sortStandings('totalWins')">
                                                            Total Wins
                                                            <mat-icon *ngIf="sortColumn === 'totalWins'">
                                                                {{ sortDirection === 'asc' ? 'arrow_downward' : 'arrow_upward' }}
                                                            </mat-icon>
                                                        </th>
                                                        <th *ngFor="let round of standingsRounds.slice().reverse()" style="min-width: 70px; padding: 4px; text-align: center;">
                                                            <span>{{ standingsType === 'matchup' ? 'Matchup' : 'Round' }}</span><br>
                                                            <span>{{ round }}</span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let player of femaleStandings; let i = index">
                                                        <td style="padding: 2px; min-width: 50px; text-align: center; font-weight: bold;">
                                                            {{ i + 1 }} <!-- Display place as 1-based index -->
                                                        </td>
                                                        <td style="padding: 2px; min-width: 135px;">{{ player.playerName }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalScore }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalScoreBeforeReduction }}</td>
                                                        <td style="padding: 2px; min-width: 80px;">{{ player.totalWins }}</td>
                                                        <td *ngFor="let score of player.scores.slice().reverse()"
                                                            [style.color]="score.isDropped || (score.isReduced && score.isSubScore) ? 'red' : 'inherit'"
                                                            [style.fontWeight]="score.isDropped ? 'bold' : 'normal'"
                                                            [style.backgroundColor]="score.isSubScore ? '#D8BFD8' : 'inherit'"
                                                            style="padding: 2px; min-width: 70px;">
                                                            {{ score.score }}
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </mat-tab>
                                    </mat-tab-group>
                                </div>
                            </div>
                        </mat-card>
                    </mat-tab>


                    <!-- Parent Tab -->
                    <mat-tab label="League Management">
                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                            <h5 class="text-center mb-3">Player and League Management</h5>

                            <!-- Nested Mat Tab Group -->
                            <mat-tab-group>
                                <mat-tab label="Modify Settings" *ngIf="selectedLeague">
                                    <div class="container-fluid">
                                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                                            <div style="margin: 20px;" class="tab-content d-flex flex-column align-items-center">
                                                <h2>Modify League Settings</h2>

                                                <!-- Modify Drop Lowest Scores -->
                                                <mat-form-field appearance="outline" style="width: 300px; margin-bottom: 20px;">
                                                    <mat-label>Drop Lowest Scores</mat-label>
                                                    <mat-select [(value)]="dropLowest" (selectionChange)="onDropLowestChange($event.value)">
                                                        <mat-option [value]="0">Don't Drop Any</mat-option>
                                                        <mat-option *ngFor="let i of [1, 2, 3, 4, 5, 6]" [value]="i">
                                                            Drop {{ i }} {{ i === 1 ? 'Score' : 'Scores' }}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <!-- Modify Number of Subs Allowed -->
                                                <mat-form-field appearance="outline" style="width: 300px; margin-bottom: 20px;">
                                                    <mat-label>Number of Subs Allowed</mat-label>
                                                    <mat-select [(value)]="numberOfSubsAllowed" (selectionChange)="onNumberOfSubsChange($event.value)">
                                                        <mat-option [value]="0">No Subs Allowed</mat-option>
                                                        <mat-option *ngFor="let i of [1, 2, 3, 4, 5, 100]" [value]="i">
                                                            Allow {{ i }} {{ i === 1 ? 'Sub' : 'Subs' }}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <!-- Modify Percent of Score for Subs -->
                                                <mat-form-field appearance="outline" style="width: 300px; margin-bottom: 20px;">
                                                    <mat-label>Percent of Score for Subs</mat-label>
                                                    <mat-select [(value)]="subScorePercent" (selectionChange)="onSubScorePercentChange($event.value)">
                                                        <mat-option *ngFor="let percent of [100, 90, 80, 70, 60, 50]" [value]="percent">
                                                            {{ percent }}%
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" style="width: 300px; margin-bottom: 20px;">
                                                    <mat-label>Percent of Score for Subs</mat-label>
                                                    <mat-select [(value)]="subScorePercent" (selectionChange)="onSubScorePercentChange($event.value)">
                                                        <mat-option *ngFor="let percent of [100, 90, 80, 70, 60, 50]" [value]="percent">
                                                            {{ percent }}%
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <!-- Save Button -->
                                                <div>
                                                    <button mat-raised-button color="primary" (click)="saveSettings()">Save Settings</button>
                                                </div>
                                            </div>
                                        </mat-card>
                                    </div>
                                </mat-tab>
                                <!-- Add Player Tab -->
                                <mat-tab label="Add Player" *ngIf="selectedLeague">
                                    <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                                        <div class="tab-content d-flex flex-column align-items-center" style="margin-bottom:20px">
                                            <h5 class="mb-2">Search for Existing Player</h5>
                                            <mat-form-field appearance="fill">
                                                <mat-label>Search Player</mat-label>
                                                <input matInput
                                                       [matAutocomplete]="auto"
                                                       [(ngModel)]="searchTerm"
                                                       (input)="onSearchPlayer($event)"
                                                       (blur)="onBlurPlayerInput()" />
                                                <mat-autocomplete #auto="matAutocomplete"
                                                                  (optionSelected)="onPlayerSelected($event.option.value)"
                                                                  [displayWith]="displayPlayer">
                                                    <mat-option *ngFor="let player of searchedPlayers"
                                                                [value]="player">
                                                        {{ player.firstName }} {{ player.lastName }}
                                                    </mat-option>
                                                </mat-autocomplete>
                                            </mat-form-field>
                                            <button mat-raised-button
                                                    style="margin-bottom:20px"
                                                    color="primary"
                                                    (click)="addExistingPlayer()"
                                                    [disabled]="!isActionAllowed">
                                                Add Existing Player
                                            </button>
                                            <mat-form-field style="max-width: 300px" appearance="outline" *ngIf="!loggedIn">
                                                <mat-label>Enter Password</mat-label>
                                                <input matInput
                                                       type="password"
                                                       (input)="onPasswordInput($event.target.value)"
                                                       placeholder="Password">
                                            </mat-form-field>
                                        </div>
                                        <div class="tab-content d-flex flex-column align-items-center" style="margin-bottom:20px">
                                            <button mat-raised-button
                                                    color="primary"
                                                    (click)="toggleNewPlayerForm()"
                                                    [class.active]="showNewPlayerForm">
                                                Enter New Player
                                            </button>

                                            <!-- Form to Add New Player -->
                                            <div *ngIf="showNewPlayerForm" class="mt-3">
                                                <form [formGroup]="PlayerForm" (ngSubmit)="onSubmitClick()" class="d-flex flex-column align-items-center">
                                                    <div class="row">
                                                        <div class="col-12 col-lg-6">
                                                            <mat-form-field style="max-width: 180px" appearance="outline">
                                                                <mat-label>First Name:</mat-label>
                                                                <input matInput placeholder="Player First Name" type="text" formControlName="firstName" value="{{addedPlayer?.firstName}}" required />
                                                            </mat-form-field>
                                                            <br />
                                                            <mat-form-field style="max-width: 180px" appearance="outline">
                                                                <mat-label>Last Name:</mat-label>
                                                                <input matInput placeholder="Player Last Name" type="text" formControlName="lastName" value="{{addedPlayer?.lastName}}" required />
                                                            </mat-form-field>
                                                            <br />
                                                            <mat-form-field style="max-width: 180px" appearance="outline" *ngIf="!loggedIn">
                                                                <mat-label>Password:</mat-label>
                                                                <input matInput placeholder="Password" type="password" formControlName="password" value="{{password}}" required />
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="col-12 col-lg-6">
                                                            <mat-form-field appearance="outline">
                                                                <mat-select formControlName="isSub" placeholder="Sub/Flex">
                                                                    <mat-option [value]="true">Sub</mat-option>
                                                                    <mat-option [value]="false">Not a Sub</mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                            <br />
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Gender:</mat-label>
                                                                <mat-select [formControl]="PlayerForm.get('selectedGender')" placeholder="Gender">
                                                                    <mat-option *ngFor="let gender of gendersPossible" [value]="gender.value">
                                                                        {{ gender.value }}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                            <br />
                                                            <div class="d-flex justify-content-center">
                                                                <button mat-raised-button color="primary">Submit</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </mat-card>
                                </mat-tab>


                                <mat-tab label="Delete Player" class="mt-2" *ngIf="selectedLeague">
                                    <div class="container-fluid">
                                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                                            <h5 class="text-center">Delete Player from {{ selectedLeague }}</h5>
                                            <br />
                                            <div class="row" style="margin-bottom:20px">
                                                <div class="col-12 d-flex flex-column align-items-center">
                                                    <mat-form-field style="max-width: 300px" appearance="outline">
                                                        <mat-label>Search Player</mat-label>
                                                        <input matInput
                                                               [matAutocomplete]="auto"
                                                               (input)="onSearchPlayerToDelete($event)"
                                                               (blur)="onBlurDeletePlayerInput()"
                                                               [(ngModel)]="searchTermDelete" />
                                                        <mat-autocomplete #auto="matAutocomplete"
                                                                          (optionSelected)="onDeletePlayerSelected($event.option.value)"
                                                                          [displayWith]="displayPlayer">
                                                            <mat-option *ngFor="let player of searchedPlayersToDelete"
                                                                        [value]="player">
                                                                {{ player.firstName }} {{ player.lastName }}
                                                            </mat-option>
                                                        </mat-autocomplete>
                                                    </mat-form-field>
                                                    <button mat-raised-button
                                                            style="margin-bottom:20px"
                                                            color="primary"
                                                            (click)="deleteSelectedPlayer()"
                                                            [disabled]="!isActionAllowed">
                                                        Delete Player
                                                    </button>
                                                    <mat-form-field style="max-width: 300px" appearance="outline" *ngIf="!loggedIn">
                                                        <mat-label>Enter Password</mat-label>
                                                        <input matInput
                                                               type="password"
                                                               (input)="onPasswordInput($event.target.value)"
                                                               placeholder="Password">
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                            <!--Deprecated-->
                                            <!--<h5 class="text-center">Delete Player</h5>
                                            <br />
                                            <div class="row">
                                                <div class="col-12 d-flex flex-column align-items-center">
                                                    <form [formGroup]="deletePlayerForm" (ngSubmit)="onDeletePlayerClick()">
                                                        <div class="d-flex flex-column align-items-center">
                                                            <mat-form-field style="max-width: 180px" appearance="outline">
                                                                <mat-label>First Name:</mat-label>
                                                                <input matInput formControlName="firstName" placeholder="Player First Name" required />
                                                            </mat-form-field>
                                                            <mat-form-field style="max-width: 180px" appearance="outline">
                                                                <mat-label>Last Name:</mat-label>
                                                                <input matInput formControlName="lastName" placeholder="Player Last Name" required />
                                                            </mat-form-field>
                                                            <mat-form-field style="max-width: 180px" appearance="outline" *ngIf="!loggedIn">
                                                                <mat-label>Password</mat-label>
                                                                <input matInput placeholder="Password" type="password" formControlName="passwordDelete" required />
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="d-flex justify-content-center">
                                                            <button mat-raised-button color="warn" class="text-center">Delete Player</button><br /><br />
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>-->
                                        </mat-card>
                                    </div>
                                </mat-tab>

                                <mat-tab label="Add League" class="mt-2">
                                    <div class="container-fluid">
                                        <mat-card style="margin-top: 20px; margin-bottom: 20px; background-color: #eeeeee">
                                            <h5 class="text-center">Enter New League</h5>
                                            <br />
                                            <form [formGroup]="LeagueForm" (ngSubmit)="addLeague()">
                                                <div class="d-flex flex-column align-items-center">
                                                    <mat-form-field style="max-width: 180px" appearance="outline">
                                                        <mat-label>New League Name</mat-label>
                                                        <input matInput placeholder="League Name" type="text" formControlName="newLeagueName" required />
                                                    </mat-form-field>
                                                    <mat-form-field style="max-width: 180px" appearance="outline" *ngIf="!loggedIn">
                                                        <mat-label>Password</mat-label>
                                                        <input matInput placeholder="Password" type="password" formControlName="passwordLeague" required />
                                                    </mat-form-field>
                                                </div>
                                                <br />
                                                <div class="d-flex justify-content-center">
                                                    <button mat-raised-button color="primary">Add New League</button>
                                                </div>
                                            </form>
                                        </mat-card>
                                    </div>
                                </mat-tab>
                            </mat-tab-group>
                        </mat-card>
                    </mat-tab>

                </mat-tab-group>
                <div class="d-flex justify-content-center align-items-start" *ngIf="(displayTopPlayers.length > 0 || displayLowPlayers.length > 0) && !hideInputOptions" style="gap: 20px;">
                    <!-- Top Players Section -->
                    <div class="top-players-section" *ngIf="displayTopPlayers.length > 0" style="width: 45%;">
                        <h5 class="text-center">
                            Top Players
                            <span *ngIf="totalTopPlayers.length > 0">({{ totalTopPlayers.length }})</span>
                        </h5>

                        <div class="player-list text-center">
                            <!-- Top Players -->
                            <ng-container *ngFor="let player of displayTopPlayers">
                                <div [ngClass]="getPlayerClass(player)"
                                     style="margin: 10px 10px; padding: 5px; border-radius: 5px;"
                                     [matTooltip]="!isPlayerInSelectedList(player) ? 'Not Selected' : ''">
                                    {{ player.firstName }} {{ player.lastName }}
                                </div>
                            </ng-container>



                        </div>
                    </div>

                    <!-- Vertical Divider -->
                    <div class="divider" style="border-left: 2px solid #ccc; height: auto;"></div>

                    <!-- Low Players Section -->
                    <div class="low-players-section" *ngIf="displayLowPlayers.length > 0" style="width: 45%;">
                        <h5 class="text-center">
                            Low Players
                            <span *ngIf="totalLowPlayers.length > 0">({{ totalLowPlayers.length }})</span>
                        </h5>

                        <div class="player-list text-center">
                            <!-- Low Players -->
                            <ng-container *ngFor="let player of displayLowPlayers">
                                <div [ngClass]="getPlayerClass(player)"
                                     style="margin: 10px 10px; padding: 5px; border-radius: 5px;"
                                     [matTooltip]="!isPlayerInSelectedList(player) ? 'Not Selected' : ''">
                                    {{ player.firstName }} {{ player.lastName }}
                                </div>
                            </ng-container>
                        </div>
                    </div>


                </div>
            </mat-card>

        </div>
    </div>
</div>
<div *ngIf="!allowScrambleWithNoDuplicates" class="toggle-button-container" style="text-align: center; margin-top: 8px; ">
    <button mat-raised-button color="primary" class="mb-1" (click)="toggleTeamSorting()">
        {{ showTeamSorting ? 'Hide Modify Teams' : 'Show Modify Teams' }}
    </button>
</div>
<!-- Container for all pairs -->
<div style="margin: 1rem;">

    <!-- Loop in multiples of 4. (i % 4 === 0) => new row for 4 teams: i, i+1, i+2, i+3 -->
    <ng-container *ngFor="let team of listOfTeams; let i = index">
        <div class="row mb-4" *ngIf="i % 4 === 0">

            <!-- CARD #1: Team i & i+1 (col-6) -->
            <div class="col-6">
                <mat-card style="padding: 1rem; border: 2px solid black; box-shadow: none;">
                    <div class="row justify-content-center align-items-center">

                        <!-- LEFT TEAM (Team i) -->
                        <div class="col-5" *ngIf="listOfTeams[i]">
                            <table class="table">
                                <thead>
                                    <!-- Team Title -->
                                    <tr>
                                        <th colspan="3" style="text-align: center; font-size: 1.4rem;">
                                            Team {{ listOfTeams[i].sortingId }}
                                        </th>
                                    </tr>
                                    <tr class="d-flex">
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">First Name</th>
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">First Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                        <th *ngIf="isSmallScreen" class="col-4" style="font-size:12px">Name</th>
                                        <th *ngIf="isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let player of listOfTeams[i].players" class="d-flex align-items-center">
                                        <!-- Male / Female / Sub logic -->
                                        <td *ngIf="player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && player.isSub"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <td *ngIf="!player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && player.isSub"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <!-- Team-switch dropdown -->
                                        <td class="col-3" *ngIf="showTeamSorting && !allowScrambleWithNoDuplicates">
                                            <select class="form-select"
                                                    style="width: 100%; min-height: 35px;"
                                                    [value]="listOfTeams[i].sortingId"
                                                    (change)="switchPlayerTeam(player, $event.target.value, listOfTeams[i].sortingId)">
                                                <option *ngFor="let otherTeam of listOfTeams"
                                                        [value]="otherTeam.sortingId"
                                                        [disabled]="otherTeam.sortingId === listOfTeams[i].sortingId">
                                                    {{ otherTeam.sortingId }}
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- MIDDLE: Court + VS (only if i+1 exists) -->
                        <div class="col-1 text-center" *ngIf="listOfTeams[i+1] && !isSmallScreen">
                            <h4 style="font-size: 18px;">Court</h4>
                            <input style="width: 35px; height: 35px; font-size: 20px;" type="text" />
                            <h4 style="font-size: 20px; margin-top: 8px;">VS</h4>
                        </div>

                        <!-- RIGHT TEAM (Team i+1) -->
                        <div class="col-5" *ngIf="listOfTeams[i+1]">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="3" style="text-align: center; font-size: 1.4rem;">
                                            Team {{ listOfTeams[i+1].sortingId }}
                                        </th>
                                    </tr>
                                    <tr class="d-flex">
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">First Name</th>
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">First Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                        <th *ngIf="isSmallScreen" class="col-4" style="font-size:12px">Name</th>
                                        <th *ngIf="isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let player of listOfTeams[i+1].players" class="d-flex align-items-center">
                                        <!-- same male/female logic -->
                                        <td *ngIf="player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && player.isSub"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <td *ngIf="!player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && player.isSub"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <!-- Team-switch dropdown -->
                                        <td class="col-3" *ngIf="showTeamSorting && !allowScrambleWithNoDuplicates">
                                            <select class="form-select"
                                                    style="width: 100%; min-height: 35px;"
                                                    [value]="listOfTeams[i+1].sortingId"
                                                    (change)="switchPlayerTeam(player, $event.target.value, listOfTeams[i+1].sortingId)">
                                                <option *ngFor="let otherTeam of listOfTeams"
                                                        [value]="otherTeam.sortingId"
                                                        [disabled]="otherTeam.sortingId === listOfTeams[i+1].sortingId">
                                                    {{ otherTeam.sortingId }}
                                                </option>
                                            </select>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div> <!-- /row inside mat-card -->
                </mat-card>
            </div>

            <!-- CARD #2: Team i+2 & i+3 (col-6) -->
            <div class="col-6" *ngIf="listOfTeams[i+2]">
                <mat-card style="padding: 1rem; border: 2px solid black; box-shadow: none;">
                    <div class="row justify-content-center align-items-center">

                        <!-- LEFT TEAM (Team i+2) -->
                        <div class="col-5" *ngIf="listOfTeams[i+2]">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="3" style="text-align: center; font-size: 1.4rem;">
                                            Team {{ listOfTeams[i+2].sortingId }}
                                        </th>
                                    </tr>
                                    <tr class="d-flex">
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">First Name</th>
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">First Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                        <th *ngIf="isSmallScreen" class="col-4" style="font-size:12px">Name</th>
                                        <th *ngIf="isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let player of listOfTeams[i+2].players" class="d-flex align-items-center">
                                        <!-- male/female logic again -->
                                        <td *ngIf="player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && player.isSub"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <td *ngIf="!player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && player.isSub"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <!-- Team-switch dropdown -->
                                        <td class="col-3" *ngIf="showTeamSorting && !allowScrambleWithNoDuplicates">
                                            <select class="form-select"
                                                    style="width: 100%; min-height: 35px;"
                                                    [value]="listOfTeams[i+2].sortingId"
                                                    (change)="switchPlayerTeam(player, $event.target.value, listOfTeams[i+2].sortingId)">
                                                <option *ngFor="let otherTeam of listOfTeams"
                                                        [value]="otherTeam.sortingId"
                                                        [disabled]="otherTeam.sortingId === listOfTeams[i+2].sortingId">
                                                    {{ otherTeam.sortingId }}
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- MIDDLE: Court + VS (only if i+3 exists) -->
                        <div class="col-1 text-center" *ngIf="listOfTeams[i+3] && !isSmallScreen">
                            <h4 style="font-size: 18px;">Court</h4>
                            <input style="width: 35px; height: 35px; font-size: 20px;" type="text" />
                            <h4 style="font-size: 20px; margin-top: 8px;">VS</h4>
                        </div>

                        <!-- RIGHT TEAM (Team i+3) -->
                        <div class="col-5" *ngIf="listOfTeams[i+3]">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="3" style="text-align: center; font-size: 1.4rem;">
                                            Team {{ listOfTeams[i+3].sortingId }}
                                        </th>
                                    </tr>
                                    <tr class="d-flex">
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">First Name</th>
                                        <th *ngIf="!isSmallScreen && !showTeamSorting" class="col-6">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">First Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-4">Last Name</th>
                                        <th *ngIf="!isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                        <th *ngIf="isSmallScreen" class="col-4" style="font-size:12px">Name</th>
                                        <th *ngIf="isSmallScreen && showTeamSorting" class="col-3">Team</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let player of listOfTeams[i+3].players" class="d-flex align-items-center">
                                        <!-- male/female logic again -->
                                        <td *ngIf="player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-blue">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-blue-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="player.isMale && player.isSub"
                                            class="col-4 extended-background-blue-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <td *ngIf="!player.isMale && !isSmallScreen && showTeamSorting" class="col-4 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !isSmallScreen && !showTeamSorting" class="col-6 extended-background-pink">
                                            {{ player.firstName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && isSmallScreen"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.firstName[0] }}.{{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && showTeamSorting"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen && !showTeamSorting"
                                            class="col-6 extended-background-pink-lastName">
                                            {{ player.lastName }}
                                        </td>
                                        <td *ngIf="!player.isMale && player.isSub"
                                            class="col-4 extended-background-pink-lastName">
                                            {{ player.lastName }} - Sub
                                        </td>

                                        <!-- Team-switch dropdown -->
                                        <td class="col-3" *ngIf="showTeamSorting && !allowScrambleWithNoDuplicates">
                                            <select class="form-select"
                                                    style="width: 100%; min-height: 35px;"
                                                    [value]="listOfTeams[i+3].sortingId"
                                                    (change)="switchPlayerTeam(player, $event.target.value, listOfTeams[i+3].sortingId)">
                                                <option *ngFor="let otherTeam of listOfTeams"
                                                        [value]="otherTeam.sortingId"
                                                        [disabled]="otherTeam.sortingId === listOfTeams[i+3].sortingId">
                                                    {{ otherTeam.sortingId }}
                                                </option>
                                            </select>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div> <!-- /row inside mat-card -->
                </mat-card>
            </div>

        </div> <!-- end of row for 4 teams (2 mat-cards) -->
    </ng-container>

    <!-- Bye Players Section (unchanged) -->
    <div class="row col-3 justify-content-center mt-5" *ngIf="byePlayers.length > 0">
        <h2 *ngIf="isSmallScreen" style="text-align:center; float:none; margin-left:-50px; font-size:18px;">
            Bye Players
        </h2>
        <h2 *ngIf="!isSmallScreen" style="text-align:center; float:none; margin-left:-50px; font-size:28px;">
            Bye Players
        </h2>
        <table class="table mt-3" style="width: 100%;">
            <thead>
                <tr class="d-flex">
                    <th *ngIf="!isSmallScreen" class="col-5">First Name</th>
                    <th *ngIf="!isSmallScreen" class="col-5">Last Name</th>
                    <th *ngIf="isSmallScreen" class="col-5" style="font-size:12px">Name</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let player of byePlayers" class="d-flex flex-column flex-sm-row">
                    <td *ngIf="player.isMale && !isSmallScreen" class="col-5 extended-background-blue">
                        {{ player.firstName }}
                    </td>
                    <td *ngIf="player.isMale && !player.isSub && isSmallScreen" class="col-5 extended-background-blue-lastName">
                        {{ player.firstName[0] }}.{{ player.lastName }}
                    </td>
                    <td *ngIf="player.isMale && !player.isSub && !isSmallScreen" class="col-5 extended-background-blue-lastName">
                        {{ player.lastName }}
                    </td>
                    <td *ngIf="player.isMale && player.isSub" class="col-5 extended-background-blue-lastName">
                        {{ player.lastName }} - Sub
                    </td>
                    <td *ngIf="!player.isMale && !isSmallScreen" class="col-5 extended-background-pink">
                        {{ player.firstName }}
                    </td>
                    <td *ngIf="!player.isMale && !player.isSub && isSmallScreen" class="col-5 extended-background-pink-lastName">
                        {{ player.firstName[0] }}.{{ player.lastName }}
                    </td>
                    <td *ngIf="!player.isMale && !player.isSub && !isSmallScreen" class="col-5 extended-background-pink-lastName">
                        {{ player.lastName }}
                    </td>
                    <td *ngIf="!player.isMale && player.isSub" class="col-5 extended-background-pink-lastName">
                        {{ player.lastName }} - Sub
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>




<div class="d-flex flex-column align-items-center mt-3">
    <!-- Save Teams Section -->
    <div class="d-flex flex-column align-items-center mb-3" style="margin-bottom: 5px;">
        <!--<button mat-raised-button color="primary" class="mb-3" *ngIf="showSaveRoundScores" (click)="saveKingQueenRoundScores()">Save Round Scores</button>-->
        <button (click)="saveKingQueenTeams()" mat-raised-button color="primary" class="mb-1">
            Save Teams
        </button>

        <p class="mb-0 text-center" *ngIf="scrambleNumber" style="margin-bottom: 3px;">Scramble Number: {{ scrambleNumber }}.</p>
        <p class="mb-0 text-center" *ngIf="scrambleNumber" style="margin-bottom: 3px;">Please save this number for future lookups.</p>
    </div>

    <!-- Print Matchups Section -->
    <div class="d-flex flex-column align-items-center">

        <!-- Matchups Per Page Selection -->
        <mat-form-field appearance="fill" class="w-75 mb-0">
            <mat-label>Matchups Per Page</mat-label>
            <mat-select [(value)]="selectedMatchupsPerPage" (selectionChange)="onSelectionChange($event)">
                <mat-option value="2">2 Matchups</mat-option>
                <mat-option value="4">4 Matchups</mat-option>
                <mat-option value="6">6 Matchups</mat-option>
            </mat-select>
        </mat-form-field>
        <button color="primary" mat-raised-button (click)="printMatchups()" class="mb-3">
            Print Matchups
        </button>
        <!--Number of Rounds Selection-->
        <mat-form-field appearance="fill" class="w-75">
            <mat-label>Number of Rounds</mat-label>
            <mat-select [(value)]="selectedRounds" (selectionChange)="onRoundsChange($event.value)">
                <mat-option *ngFor="let round of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]" [value]="round">
                    {{ round }} Rounds
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</div>


<div class="text-center" style="margin-top: 10px;">

    <button *ngIf="!hideEverything" (click)="hideShowEverything()" mat-raised-button class="my-class" color="primary">Hide</button>
    <button *ngIf="hideEverything" (click)="hideShowEverything()" mat-raised-button class="my-class" color="primary">Show</button>
    <button *ngIf="hideEverything && !lockedResults" (click)="scramblePlayers(false)" style="margin-left:10px; " class="my-class" mat-raised-button color="primary">Scramble</button>
</div>



<!-- Print Section -->
<div id="printSection2">
    <div style="text-align: center; margin-bottom: 20px;">
        <h2>Matchups & Scores</h2>
    </div>

    <!-- Matchups Section -->
    <div *ngFor="let team of listOfTeams; let i = index">
        <!-- Only show matchups for even-indexed teams -->
        <div *ngIf="i % 2 === 0 && listOfTeams[i + 1]" style="display: table; width: 100%; page-break-inside: avoid;">
            <div style="display: table-cell; width: 48%; vertical-align: top;">
                <h4 style="text-align: center;">{{ "Team " + (i + 1) }}</h4>
                <table class="table table-bordered" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let player of team.players">
                            <td style="font-size: 16px; padding: 5px;">{{ player.firstName }}</td>
                            <td style="font-size: 16px; padding: 5px;">{{ player.lastName }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="display: table-cell; width: 48%; vertical-align: top; padding-left: 20px;">
                <h4 style="text-align: center;">{{ "Team " + (i + 2) }}</h4>
                <table class="table table-bordered" style="width: 100%;">
                    <thead>
                        <tr>
                            <th style="font-size: 16px; padding: 5px;">First Name</th>
                            <th style="font-size: 16px; padding: 5px;">Last Name</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let player of listOfTeams[i + 1]?.players">
                            <td>{{ player.firstName }}</td>
                            <td>{{ player.lastName }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Scores Table Below the Two Matchups -->
        <div *ngIf="i % 2 === 0 && listOfTeams[i + 1]" style="text-align: center; margin-bottom: 40px; margin-top: 20px; page-break-inside: avoid; ">
            <h4>Scores</h4>
            <table class="table table-bordered" style="width: 80%; margin: 0 auto;">
                <thead>
                    <tr>
                        <th>Team</th>
                        <th *ngFor="let round of [].constructor(selectedRounds); let index = index">Game {{ index + 1 }}</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Team A</td>
                        <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                        <td style="height: 15px; padding: 3px;">&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Team B</td>
                        <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                        <td style="height: 15px; padding: 3px;">&nbsp;</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Force a page break after every two matchups -->
        <div *ngIf="(i + 2) % 4 === 0" style="page-break-after: always;"></div>
    </div>

    <!-- Bye Players Section -->
    <div style="margin-top: 30px; page-break-inside: avoid;">
        <h3 style="text-align: center;">Bye Players</h3>
        <table class="table table-bordered" style="width: 50%; margin: 0 auto;">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let player of byePlayers">
                    <td>{{ player.firstName }}</td>
                    <td>{{ player.lastName }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="printSection4" style="font-size: 8px; padding: 5px;">
    <ng-container *ngFor="let team of listOfTeams; let i = index">
        <!-- Ensure a new page starts after every 4 matchups -->
        <div *ngIf="i % 8 === 0" style="page-break-before: always;">

            <!-- Header for each page -->
            <div style="text-align: center; margin-bottom: 10px;">
                <h2 style="font-size: 12px;">Matchups & Scores</h2>
            </div>

            <!-- Flex Container for 4 Matchups Per Page -->
            <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 10px;">

                <!-- Loop through 4 matchups -->
                <ng-container *ngFor="let matchIndex of [0, 2, 4, 6]">
                    <ng-container *ngIf="listOfTeams[i + matchIndex] && listOfTeams[i + matchIndex + 1]">
                        <div style="width: 48%; border: 1px solid black; padding: 5px; margin-bottom: 10px; box-sizing: border-box;">
                            <!-- Team A -->
                            <div>
                                <h4 style="text-align: center; margin: 5px 0; font-size: 10px;">{{ "Team A (Team " + (i + matchIndex + 1) + ")" }}</h4>
                                <table class="table table-bordered" style="width: 100%; font-size: 8px;">
                                    <tbody>
                                        <tr *ngFor="let player of listOfTeams[i + matchIndex]?.players">
                                            <td style="font-size: 14px; padding: 5px;">{{ player.firstName }} {{ player.lastName }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Team B -->
                            <div style="margin-top: 5px;">
                                <h4 style="text-align: center; margin: 5px 0; font-size: 10px;">{{ "Team B (Team " + (i + matchIndex + 2) + ")" }}</h4>
                                <table class="table table-bordered" style="width: 100%; font-size: 8px;">
                                    <tbody>
                                        <tr *ngFor="let player of listOfTeams[i + matchIndex + 1]?.players">
                                            <td style="font-size: 14px; padding: 5px;">{{ player.firstName }} {{ player.lastName }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Scores -->
                            <div style="margin-top: 5px; text-align: center;">
                                <h5 style="font-size: 10px;">Scores</h5>
                                <table class="table table-bordered" style="width: 100%; font-size: 8px; margin: 0 auto;">
                                    <thead>
                                        <tr>
                                            <th>Team</th>
                                            <th *ngFor="let round of [].constructor(selectedRounds); let index = index">Game {{ index + 1 }}</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Team A</td>
                                            <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                                            <td style="height: 15px; padding: 3px;">&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Team B</td>
                                            <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                                            <td style="height: 15px; padding: 3px;">&nbsp;</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
        </div>
    </ng-container>

    <!-- Bye Players Section -->
    <div *ngIf="byePlayers && byePlayers.length > 0" style="margin-top: 10px; page-break-inside: avoid;">
        <h3 style="text-align: center; font-size: 10px;">Bye Players</h3>
        <table class="table table-bordered" style="width: 50%; margin: 0 auto; font-size: 8px;">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let player of byePlayers">
                    <td>{{ player.firstName }}</td>
                    <td>{{ player.lastName }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="printSection6" style="font-size: 8px; padding: 5px;">
    <ng-container *ngFor="let team of listOfTeams; let i = index">
        <!-- Ensure a new page starts after every 6 matchups -->
        <div *ngIf="i % 12 === 0" style="page-break-before: always;">
            <!-- Header for each page -->
            <div style="text-align: center; margin-bottom: 10px;">
                <h2 style="font-size: 12px;">Matchups & Scores</h2>
            </div>

            <!-- Flex Container for 6 Matchups Per Page -->
            <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 10px;">
                <ng-container *ngFor="let j of [0, 2, 4, 6, 8, 10]">
                    <ng-container *ngIf="listOfTeams[i + j] && listOfTeams[i + j + 1]">
                        <!-- Matchup Block -->
                        <div style="width: 48%; border: 1px solid black; padding: 5px; margin-bottom: 10px; box-sizing: border-box;">
                            <!-- Teams Side by Side -->
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <!-- Team A -->
                                <div style="width: 48%; border-right: 1px solid black; padding-right: 5px;">
                                    <h4 style="text-align: center; margin: 5px 0; font-size: 10px;">
                                        {{ "Team A (Team " + (i + j + 1) + ")" }}
                                    </h4>
                                    <table class="table table-bordered" style="width: 100%; font-size: 8px;">
                                        <thead>
                                            <tr>
                                                <th>Player Name</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let player of listOfTeams[i + j]?.players">
                                                <td style="font-size: 14px; padding: 5px;">{{ player.firstName }} {{ player.lastName }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Team B -->
                                <div style="width: 48%; padding-left: 5px;">
                                    <h4 style="text-align: center; margin: 5px 0; font-size: 10px;">
                                        {{ "Team B (Team " + (i + j + 2) + ")" }}
                                    </h4>
                                    <table class="table table-bordered" style="width: 100%; font-size: 8px;">
                                        <thead>
                                            <tr>
                                                <th>Player Name</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let player of listOfTeams[i + j + 1]?.players">
                                                <td style="font-size: 14px; padding: 5px;">{{ player.firstName }} {{ player.lastName }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Scores -->
                            <div style="margin-top: 5px; text-align: center;">
                                <h5 style="font-size: 10px;">Scores</h5>
                                <table class="table table-bordered" style="width: 100%; font-size: 8px; margin: 0 auto;">
                                    <thead>
                                        <tr>
                                            <th>Team</th>
                                            <th *ngFor="let round of [].constructor(selectedRounds); let index = index">Game {{ index + 1 }}</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Team A</td>
                                            <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                                            <td style="height: 15px; padding: 3px;">&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td>Team B</td>
                                            <td *ngFor="let round of [].constructor(selectedRounds)" style="height: 15px; padding: 3px;">&nbsp;</td>
                                            <td style="height: 15px; padding: 3px;">&nbsp;</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
        </div>
    </ng-container>

    <!-- Bye Players Section -->
    <div style="margin-top: 10px; page-break-inside: avoid;">
        <h3 style="text-align: center; font-size: 10px;">Bye Players</h3>
        <table class="table table-bordered" style="width: 50%; margin: 0 auto; font-size: 8px;">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let player of byePlayers">
                    <td style="font-size: 14px; padding: 5px;">{{ player.firstName }}</td>
                    <td style="font-size: 14px; padding: 5px;">{{ player.lastName }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


